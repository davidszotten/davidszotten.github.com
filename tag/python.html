<!DOCTYPE html>
<html lang="en">
<head>
        <title>davidszotten - python</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href=".././theme/css/main.css" type="text/css" />
        <link href=".././feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="davidszotten ATOM Feed" />
        

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href=".././css/ie.css"/>
                <script src=".././js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href=".././css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">

    <header id="banner" class="body">
            <h1><a href="../.">davidszotten </a></h1>
    </header><!-- /#banner -->
    <div id="container">
        <nav><ul>
        
            <li><a href=".././about.html">about</a></li>

        
        
        
        
        
            <li ><a href=".././category/blog.html">blog</a></li>
        
        </ul></nav>

                

            

        
        
            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href=".././automating-save-build-refresh-on-os-x.html">Automating save-build-refresh on os x</a></h1> 
                    <footer class="post-info">
<p>
        <abbr class="published" title="2012-04-15T00:00:00">
                Sun 15 April 2012
        </abbr>

</p>
<p>tags: <a href=".././tag/osx.html">osx</a> <a href=".././tag/pelican.html">pelican</a> <a href=".././tag/python.html">python</a> </p>


</footer><!-- /.post-info --><p>This blog is powered by <a href="https://github.com/ametaireau/pelican/">Pelican</a>. When I first started out, I was composing in vim, switching over to a terminal to build, and finally to my browser to preview the result. Clearly this becomes tedious pretty quickly.</p>
<p>I was already familiar with tools to watch folders for changes and trigger actions, and I recently discovered that I could use a bit of applescript to refresh my browser, saving precious seconds and make the workflow feel more natural.</p>
<p>I already have a makefile for the actual build step. It's a fairly trivial command but this file saves me rembmering it:</p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="nv">cat</span> <span class="n">Makefile</span>
<span class="n">html:</span>
    <span class="n">pelican</span> <span class="o">.</span> <span class="o">-</span><span class="n">s</span> <span class="n">settings</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">o</span> <span class="o">../</span><span class="n">output_folder</span>
</pre></div>


<p>Along with this i use a python script calling the <a href="http://pypi.python.org/pypi/MacFSEvents">MacFSEvents</a> library. This lets me watch a folder for changes, and exectue a function as a reaction. My setup is pretty much straight from the docs:</p>
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">fsevents</span> <span class="kn">import</span> <span class="n">Observer</span><span class="p">,</span> <span class="n">Stream</span>

<span class="c"># ignore vim swap files</span>
<span class="n">swp_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;\.sw.$|~$&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">swp_regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
        <span class="c"># uses subprocess to call &#39;make html&#39;</span>
        <span class="n">pelican_build</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">observer</span> <span class="o">=</span> <span class="n">Observer</span><span class="p">()</span>
    <span class="n">observer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="n">stream</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="n">file_events</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">observer</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

    <span class="c"># trap ctrl-c and exit gracefully</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">observer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="n">observer</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</pre></div>


<p>This was my setup as of this morning. The new addition, is a second function called by the callback: <code>reload_browser()</code></p>
<div class="codehilite"><pre><span class="n">url_identifier</span> <span class="o">=</span> <span class="s">&#39;localhost&#39;</span>
<span class="n">brower</span> <span class="o">=</span> <span class="s">&#39;Google Chrome&#39;</span>

<span class="n">reload_string</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">tell application &quot;</span><span class="si">%s</span><span class="s">&quot;</span>
<span class="s">    set windowList to every window</span>
<span class="s">    repeat with aWindow in windowList</span>
<span class="s">        set tabList to every tab of aWindow</span>
<span class="s">        repeat with atab in tabList</span>
<span class="s">            if (URL of atab contains &quot;</span><span class="si">%s</span><span class="s">&quot;) then</span>
<span class="s">                tell atab to reload</span>
<span class="s">            end if</span>
<span class="s">        end repeat</span>
<span class="s">    end repeat</span>
<span class="s">end tell &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">brower</span><span class="p">,</span> <span class="n">url_identifier</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">reload_browser</span><span class="p">():</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s">&#39;osascript&#39;</span><span class="p">],</span>
        <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">stdin</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
    <span class="p">)</span>
    <span class="n">pipe</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">reload_string</span><span class="p">)</span>
</pre></div>


<p>The apple script looks through all my tabs for urls matching a given string, and reloads them. So now all i need to do is save the source file i'm editing, and look over to see my browser reloading. Beautiful!</p><p>There are <a href=".././automating-save-build-refresh-on-os-x.html#disqus_thread">comments</a>.</p>
                </article>
                
            </aside><!-- /#featured -->
            
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                        <ol id="posts-list" class="hfeed">
            
        
        
        
        

        
         
            
            <li><article class="hentry">    
                <header>
                        <h1><a href=".././introspecting-django-urls-for-fun-and-profit.html" rel="bookmark" title="Permalink to Introspecting django urls for fun and profit">Introspecting django urls for fun and profit</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
<p>
        <abbr class="published" title="2012-04-14T00:00:00">
                Sat 14 April 2012
        </abbr>

</p>
<p>tags: <a href=".././tag/django.html">django</a> <a href=".././tag/python.html">python</a> </p>


</footer><!-- /.post-info -->
                <p>One of the projects I work on has a fairly large and old code base, and is unfortunately somewhat lacking in the test suite department. We are working to improve this, but in the medium term we are stuck with a fair amount of manual testing.</p>
<p>As part of some ...</p>
                <a class="readmore" href=".././introspecting-django-urls-for-fun-and-profit.html">read more</a>
                <p>There are <a href=".././introspecting-django-urls-for-fun-and-profit.html#disqus_thread">comments</a>.</p>
                </div><!-- /.entry-content -->
            </article></li>
        
        
        

        
         
            
            <li><article class="hentry">    
                <header>
                        <h1><a href=".././show-number-of-queries-in-runserver-output.html" rel="bookmark" title="Permalink to Show number of queries in runserver output">Show number of queries in runserver output</a></h1>
                </header>
                
                <div class="entry-content">
                <footer class="post-info">
<p>
        <abbr class="published" title="2012-03-03T00:00:00">
                Sat 03 March 2012
        </abbr>

</p>
<p>tags: <a href=".././tag/django.html">django</a> <a href=".././tag/python.html">python</a> </p>


</footer><!-- /.post-info -->
                <p>Sometimes I'd like to know how many database queries were used to generate a particular view, but can't be bothered with the full weight of the (otherwise excellent) <a href="http://pypi.python.org/pypi/django-debug-toolbar">django-debug-toolbar</a>.</p>
<p>The toolbar does a lot of logging and slows down rendering. Also, by default I want <code>'INTERCEPT_REDIRECTS': False</code>, but ...</p>
                <a class="readmore" href=".././show-number-of-queries-in-runserver-output.html">read more</a>
                <p>There are <a href=".././show-number-of-queries-in-runserver-output.html#disqus_thread">comments</a>.</p>
                </div><!-- /.entry-content -->
            </article></li>
        
        
            
        

    
    </ol><!-- /#posts-list -->
    </section><!-- /#content -->



    </div>
    


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-9812324-6");
    pageTracker._trackPageview();
    } catch(err) {}</script>



<script type="text/javascript">
    var disqus_shortname = 'davidszottenblog';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</body>
</html>